// Run as `node ./raml2graphql [-v] inputs/inventory.raml`

const argv0 = process.argv[1].replace(/.*\//, '');
let verbose = false;
if (process.argv[2] == '-v') {
  verbose = true;
  process.argv.shift();
}
const file = process.argv[2];
if (!file) {
  console.error(`Usage: ${argv0}: SOMEFILE.raml`);
  process.exit(1);
}

// Ideally, we want a library that reads the RAML and knows how to
// include the information from the references JSON Schemas. But if we
// can't find such a thing, it would suffice to parse it as YAML and
// walk the tree ourselves to discover the schemas.

const raml = require('raml-1-parser');
let api;
try {
  api = raml.parseSync(file);
} catch(e) {
  console.error(`${argv0}: RAML parse failed:`, e);
  process.exit(2);
}

if (verbose) {
  console.log(`api is a ${api.constructor.name}`); // ASTNodeImpl
  console.log(JSON.stringify(api.toJSON(), null, 2));
}

emitComment(api, 'title')
emitComment(api, 'version')
emitComment(api, 'protocols')
emitComment(api, 'baseUri')

var apiResources = api.elementsOfKind("resources");
apiResources.forEach((resource, i) => {
   console.log("" + (i+1) + ". " + resource.attr("relativeUri").value());
});


function emitComment(api, tag) {
  const attrs = api.attributes(tag);
  const rendered = [];

  attrs.forEach((attr) => {
    const value = attr.plainValue();
    rendered.push(`${value} (${typeof value})`);
  });

  console.log(`# ${tag}: ${rendered.join(', ')}`);
}
